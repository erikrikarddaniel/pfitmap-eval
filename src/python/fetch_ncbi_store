#!/usr/bin/env python
# -*- coding: utf-8 -*-

from Bio import Entrez
from Bio import SeqIO
from BioSQL import BioSeqDatabase
from argparse import ArgumentParser

BATCH_SIZE = 200
TOOL = 'fetch_ncbi_store'

def _fetch(accnos, email, db):
  print accnos, email, db

if __name__=='__main__':
  parser = ArgumentParser(description='Script to fetch protein GenBank entries from NCBI and store in BioSQL database')
  parser.add_argument('email', help='Email for NCBI web service')
  parser.add_argument('db', help='Local database to connect to, using credentials of UNIX user')
  parser.add_argument('accno_file', help='File with accession numbers, one per line, to fetch')
  parser.add_argument('--verbose', dest='verbose', action='store_true')
  parser.add_argument('--no-verbose', dest='verbose', action='store_false')
  parser.set_defaults(verbose=True)

  args = parser.parse_args()

# Read the accession number file
accnos = []
file = open(vars(args)['accno_file'])
for line in file:
  accnos.append(line.rstrip('\n'))

  if len(accnos) > 0 and len(accnos) % BATCH_SIZE == 0:
    _fetch(accnos, vars(args)['email'], vars(args)['db'])
    accnos = []

# Call for the last set of accession numbers
_fetch(accnos, vars(args)['email'], vars(args)['db'])
